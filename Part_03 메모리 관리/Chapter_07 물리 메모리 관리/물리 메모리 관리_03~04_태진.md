# 03. 단일 프로그래밍 환경의 메모리 할당

## 1. 메모리 오버레이

프로그램의 크기가 실제 메모리보다 클 때 적당한 크기로 잘라서 가져오는 기법을 뜻한다.

필요할때마다 모듈을 메모리에 가져옴.

메모리 오버레이에서 어떤 모듈을 가져오거나 내보낼지는 CPU레지스터 중 하나인 PC(프로그램 카운터)가 결정함. 

## 2. 스왑

메모리에 조각 낸 모듈 중 다음 모듈을 가져오는 경오 먼저 메모리에 올라온 모듈을 별도의 공간에 보관해야한다.

메모리가 모자라서 쫓겨난 프로세스를 저장해두는 공간을 '스왑 영역'이라 한다.

- swap in : 메모리로 데이터를 가져옴
- swap out : 스왑으로 데이터를 내보냄.

스왑 영역은 메모리 관리자가 관리함.

메모리 오버레이로 프로그램을 메모리보다 작은 크기의 모듈로 사용하고, 스왑 영역의 크기를 포함해서 전체 메모리의 크기로 사용자는 인식한다.

e.g) 윈도우의 절전 기능은 스왑임.<br> 
e.g2) 유닉스는 free로 확인 가능. 보통 메모리의 2배정도로 잡음.

# 04. 다중 프로그래밍 환경의 메모리 할당

## 1. 메모리 분할 방식
메모리에 여러개의 프로세스를 배치하는 방법
- 가변 분할 방식(variable-size partitioning)
  - 프로세스의 크기에 따라 메모리를 나눔
  - 따라서 차지하는 메모리 크기가 다름
  - 한 프로세스가 메모리의 연속된 공간에 배치됨(연속 메모리 할당)
  - 장점 :
    - 연속된 공간 배치
  - 단점 : 
    - 메모리 통합등의 부가적인 작업이 필요해서 메모리 관리 복잡함.
  
- 고정 분할 방식(fixed-size partitioning)
  - 프로세스의 크기와 상관없이 메모리를 같은 크기로 나눔
  - 같은 크기로 나누고, 메모리가 부족하면 스왑 영역에 배치한다.
  - 한 프로세스가 여러개로 나뉘어 배치되기때문에 비연속 메모리 할당.
  - 장점 : 
    - 메모리 관리가 편함. 
  - 단점 : 
    - 여러개로 나뉠 수 있음.
  - 그치만 스왑이 도와주기때문에 현대는 default가 고정 분할 방식임.

## 2. 가변 분할 방식의 메모리 관리
세그먼테이션 메모리 관리 기법이라 함.

중간 프로세스가 종료되면 빈공간이 생기고, 빈공간을 합치지 못했기 때문에 비어있는 공간보다 큰 프로세스를 배치시킬수 없음.

이렇게 발생한 공간을 fragmentation(단편화)라고 하고, 프로세스 바깥에 위치하기 때문에 external fragmentation이라함.

이런 문제를 해결하기 위해 '메모리 배치 방식', '조각 모음'을 사용함. 

- 메모리 배치방식 : 작은 조각이 발생되지 않도록 배치함.(선처리)
  - first fit : 단편화 고려하지 않음. 순서대로 찾다가 처음 가능한 공간에 배치
  - best fit : 가장 적당한 곳에 배치. 단편화 확률 낮음.
  - worst fit : 가장 여유있는 곳에 배치. 남은 공간이 쓸모있음.
- 조각 모음 : 작은 조각 들을 모아서 큰 덩어리로 만듬.(후처리)
  - 남은 조각을 한 곳으로 모아줌.
  - 메모리 통합이라 부름.
  - 이동할 때 프로세스의 논리 주소 값을 바꿔줌.
  - 많은 시간이 걸리고, 부가적인 작업이 필요해서 메모리 관리가 복잡함.

## 3. 고정 분할 방식의 메모리 관리
페이징 메모리 관리 기법이라 함.

현대의 메모리 관리는 페이징이 기본임.

- 단점
  - 일정하게 나뉜 메모리의 크기보다 작은 프로세스가 배치되는 경우 낭비 공간이 발생
    - 이로 인해 공간이 남는 것을 내부 단편화(internal fragmentation)
    - 조각 모음이 불가능하다
    

## 4. 버디 시스템
가변 분할 방식의 외부 단편화를 완화하는 방법. 

가변과 고정의 중간 구조임.

- 메모리를 1/2씩 나눠서 적당한 공간을 찾아내서 배치하는 방식임.
- 프로세스가 종료되면 주변을 하나로 합친다.
- 비슷한 크기의 덩어리가 모이기 때문에 통합이 쉬운 장점이 있다.
- 공간관리 측면에서 고정 방식과 버디는 비슷한 수준이지만, 나누어가며 하는 것보다 고정하는게 단순하기 때문에 더 많이 사용되는 것이다.










