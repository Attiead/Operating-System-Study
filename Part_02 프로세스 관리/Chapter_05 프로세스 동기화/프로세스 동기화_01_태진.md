## 01 프로세스 간 통신

### 1. 프로세스 간 통신의 개념
프로세스 혹은 스레드는 독립적으로 실행된다.<br>
프로세스나 스레드가 협업하거나 여러 데이터를 병렬로 처리하기 위해서는 데이터를 주고받아야 한다.

- 스레드는 하나의 프로세스 내에서 자원을 공유하는 실행 단위다.
- 하나의 프로세스에 속한 스레드끼리 데이터를 주고받는 것은 쉬움.
- 프로세스간 통신은 어려움
  - 서로 다른 프로세스는 사용하는 메모리 영역이 다르기 때문.
  - 그래서 OS가 제공하는 데이터를 주고 받을 수 있는 통신 방법을 제공하는데 이를 IPC(Inter Process Communication)이라함.


1. 공유 메모리나 공유 파일을 이용한 통신
   1. 가장 원시적인 방법
   2. 일정한 메모리 영역이나 파일을 공유하는 방식을 프로세스끼리 알아서 결정해야 한다.
   
2. 파이프를 이용한 통신
   1. 프로세스 간 통신에 많이 사용되는 수단이 파이프임. 
   2. 운영체제가 제공하는 통신 기법임.
   3. 파이프는 fork()로 만들어진 부모-자식 간 통신에 사용된다.
   
3. 소켓을 이용한 통신
   1. 컴퓨터와 컴퓨터가 네트워크로 연결된 경우의 통신에 주로 사용되는 수단은 소켓임.
   2. 물론 컴퓨터 내의 프로세스 끼리도 소켓으로 통신할 수 있음. 
   3. 파이프와 비교하면 소켓방식은 초기화할 내용도 많고 시스템 자원도 많이 사용하기 때문에 같은 컴퓨터 내에서 소켓 통신하는 것은 비효율 적임.

통신이란 send & receive.

<br>


### 2. 프로세스 간 통신의 분류

#### 통신 방향에 따른 분류
프로세스 간 통신은 동시에 실행되는 프로세스끼리 데이터를 주고 받는 작업임.

양방향, 반양방향, 단방향 통신으로 나뉨.
> 함수 호출도 데이터를 주고 받는 것이지만, 하나의 프로세스 내에서 순차적으로 실행되기 때문에 통신이라고 부르지 않음.

- 양방향 통신
  - 양쪽 방향으로 동시에 전송할 수 있는 구조.
  - 일반적인 방식이고, **소켓을 이용한 방식**이 이에 해당됨.
  - 소켓은 양방향 통신을 지원하므로 1개만으로도 데이터를 주고 받을 수 있다.


- 반양방향 통신
  - 양쪽 방향으로 전송할 수 있지만, 동시 전송은 불가능하고 특정 시점에 한쪽 방향으로만 전송할 수 있는 구조
  - 무전기임.

- 단방향 통신
  - 모스 부호 같이 한쪽으로만 데이터를 전송할 수 있는 구조.
  - **공유메모리나 공유 파일을 이용한 통신**과 **파이프를 이용한 통신**이 단방향 통신에 해당됨.
  - 공유메모리를 이용한 통신의 경우 누군가 공유메모리에 데이터를 쓰면 이전에 있는 데이터는 사라진다.
  - 단방향 통신에서 양방향 통신을 구현하고 싶다면 공유 메모리, 파이프는 2개가 필요하다.

<br>

#### 통신 구현 방식에 따른 분류
공유메모리를 사용하는 통신 방식의 가장 큰 문제는 상대방이 데이터를 언제 보낼지 받는 쪽에서 모른다는 것.<br>
그래서 반복적으로 공유메로리를 점검해야 한다.

이러한 상태 변화를 살펴보기 위해 반복문을 무한 실행하며 기다리는 행위를 바쁜 대기(busy waiting)이라 함.<br>
바쁜 대기는 시스템 차원에서 자원 낭비가 크기 때문에 안좋은 프로그램의 예이다.

이를 해결하기 위해 데이터가 도착했을을 알려주는 '동기화(synchronization)'를 사용한다.<br>
메신저에서는 알림을 통해 동기화를 사용함. 동기화를 사용하면 바쁜대기를 하지 않아도 OS가 알려줌.

프로세스 간 통신은 동기화 기능 유무에 따라 2가지로 구분됨.
- '대기가 있는 통신(blocking)'은 동기화 통신(synchronous)이라고도 함
  - 동기화를 지원. 받는쪽은 데이터가 도착할 때까지 자동으로 대기 상태.
- '대기가 없는 통신(non-blocking)'은 비동기화 통신(asynchronous)이라고도 함.
  - 동기화를 미지원. 받는쪽은 바쁜 대기를 사용하여 데이터가 도착했는지 여부를 직접 확인.

> 파이프를 이용한 통신과 소켓을 이용한 통신은 대기가 있는 통신이므로 바쁜대기를 사용하지 않고도 통신이 가능.<br>
> 공유메모리는 바쁜대기를 사용한다.

<br>

### 3. 프로세스 간 통신의 종류
#### 파일을 이용한 통신
파일 입출력 코드는 열기, 쓰기 또는 읽기, 닫기 로 구성된다.

- 파일 열기
  - 준비 단계
  - 사용하고자 하는 파일이 있는지, 파일이 있다면 쓰기 권한이 있는지 확인
  - 파일이 사용가능하다면 fd를 반환함.
    - fd(file-descriptor)는 파일에 접근 할 수 있는 일종의 열쇠임.
  - 작업이 끝나면 fd를 다시 돌려준다. 
  - open("com.txt", 0_RDWR)
    - 0_RDWR : 읽기와 쓰기 작업을 하겠다는 뜻. 
    - 0_RDONLY : 읽기 전용
- 파일 쓰기 또는 읽기
  - fd는 해당 파일에 대한 접근 권한을 가지므로 쓰기나 읽기 연산의 맨 앞에는 언제나 fd를 사용함.
  - write(fd, "Test", 5) 
    - com.text 파일에 Test라는 문자열을 써라. 
    - Test의 크기가 5B이기 때문에 5라고 명시함
      - 4글자이지만 문자열의 끝을 알리는 null을 포함시키기 때문에 5B이다.
  - read(fd, buf, 5)
    - com.txt 파일에서 5B를 읽어 변수 buf에 저장하라는 뜻.
- 파일 닫기
  - close() 함수를 이용해서 파일을 닫음.
  - close(fd)
    - com.txt 파일을 닫음.

write를 통해 입출력 관리 프로세스에 쓰기를 요구에서 데이터를 저장하고, read를 통해 데이터를 가져오기 때문에 파일 입출력도 통신이다.

- 파일을 이용한 통신은 부모-자식 관계의 프로세스 간 통신에 많이 사용되며, OS가 동기화를 제공하지 않는다.
- 부모 프로세스가 wait() 함수를 이용하여 자식 프로세스의 작업이 끝날때까지 기다렸다가 작업을 시작한다.

<br>

#### 파이프를 이용한 통신
파이프를 이용한 통신은 운영체제가 제공하는 동기화 통신방식으로, open()으로 기술자를 얻어 작업한 후 close() 함수로 마무리한다.

단방향 통신이며, 파이프를 2개 사용해야 한다.

- 파이프에 쓰기 연산을 하면 데이터가 전송되고 읽기 연산을 하면 데이터를 받는다.
- 받는 쪽의 프로세스가 읽기 연산을 수행했는데 보내는 쪽의 프로세스가 쓰기 연산을 하지 않았다면 받는쪽은 대기상태가 된다.
  - 대기 상태는 보내는 쪽의 프로세스가 쓰기 연산을 하는 순간 자동으로 풀리며 동기화 된다. 
  - 바쁜대기를 사용하지 않아도 된다.

- 이름 없는 파이프
  - 일반적인 파이프.
  - 부모와 자식 프로세스 혹은 같은 부모를 가진 자식프로세스와 같이 관련있는 프로세스간 통신에 사용됨.
- 이름 있는 파이프
  - FIFO라 불리는 특수 파일을 이용해서 서로 관련 없는 프로세스 간 통신에 사용됨.

#### 소켓을 이용한 통신
네트워킹이라 부르며 소켓을 이용한 통신임.

- IP : 목적지까지 데이터를 전송할 때 사용되는 주소
- PORT : TCP가 네트워크를 사용하는 프로세스를 구분하기 위해 사용하는 주소.
- 데몬(daemon)
  - 서버에서 돌아가는 프로세스. 서버용 데몬도 포트 번호가 필요함.
  - 서버에서 임의의 포트 번호를 부여하면 클라이언트가 해당 번호를 매번 찾아야 한다.
  - 중요한 서버용 프로세스(데몬)에는 미리 정해진 포트를 할당
    - 웹 데몬(HTTPD)는 80
    - 파일 데몬(FTPD)는 21
  - 서버 쪽의 웹 데몬의 80번 포트를 여러 클라이언트가 방문하려면 다음 사람을 기다려야한다.
    - 이때 하나의 포트를 여러 클라이언트에게 연결하면 **소켓**이 필요하다.
    - 클라이언트들은 포트에 연결된 소켓에 하나씩 연결된다.
  - 결국 네트워크에서 데이터를 보낸다는 것은 클라이언트 소켓이 서버 소켓에 데이터를 보내는 것.
    - 네트워크 프로그래밍 == 소켓 프로그래밍 

네트워킹 상황에서 통신할 때는 '원격 프로시저 호출'이나 '소켓'을 이용한다.
- 프로시저 호출 : 한 컴퓨터에 있는 함수를 호출
- 원격 프로시저 호출 : 다른 컴퓨터에 있는 함수를 호출
  - 자바는 다른 컴퓨터에 있는 객체의 메서드를 불러와 사용할때 원격 프로시저 호출을 한다. 
    - 원격 서버가 가지고 있는 함수를 직접 가져와서 코드 내에서 활용할 수 있는 것을 뜻함.
    - API 통신 방식 중 gRPC가 이 방식을 google에서 구현한 방식임
  - 다른 컴퓨터에 있는 프로세스와 통신하려면 그 컴퓨터의 위치를 파악하고, 원격지의 시스템 내 여러 프로세스 중 어떤것과 통신할지 결정해야 한다.
  - 소켓은 프로세스 동기화를 제공하므로 바쁜 대기를 하지 않아도 됨.

## 2. 
